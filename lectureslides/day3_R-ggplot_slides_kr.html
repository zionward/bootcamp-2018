<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Kumar Ramanathan" />
  <meta name="dcterms.date" content="2018-09-19" />
  <title>Advanced R: Day 3, part 3</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="day3_R-ggplot_slides_kr_files/reveal.js-3.3.0.1/css/reveal.css"/>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="day3_R-ggplot_slides_kr_files/reveal.js-3.3.0.1/css/theme/simple.css" id="theme">


  <!-- some tweaks to reveal css -->
  <style type="text/css">
    .reveal h1 { font-size: 2.0em; }
    .reveal h2 { font-size: 1.5em;  }
    .reveal h3 { font-size: 1.25em;	}
    .reveal h4 { font-size: 1em;	}

    .reveal .slides>section,
    .reveal .slides>section>section {
      padding: 0px 0px;
    }



    .reveal table {
      border-width: 1px;
      border-spacing: 2px;
      border-style: dotted;
      border-color: gray;
      border-collapse: collapse;
      font-size: 0.7em;
    }

    .reveal table th {
      border-width: 1px;
      padding-left: 10px;
      padding-right: 25px;
      font-weight: bold;
      border-style: dotted;
      border-color: gray;
    }

    .reveal table td {
      border-width: 1px;
      padding-left: 10px;
      padding-right: 25px;
      border-style: dotted;
      border-color: gray;
    }


  </style>

    <style type="text/css">code{white-space: pre;}</style>


<!-- Printing and PDF exports -->
<script id="paper-css" type="application/dynamic-css">

/* Default Print Stylesheet Template
   by Rob Glazebrook of CSSnewbie.com
   Last Updated: June 4, 2008

   Feel free (nay, compelled) to edit, append, and
   manipulate this file as you see fit. */


@media print {

	/* SECTION 1: Set default width, margin, float, and
	   background. This prevents elements from extending
	   beyond the edge of the printed page, and prevents
	   unnecessary background images from printing */
	html {
		background: #fff;
		width: auto;
		height: auto;
		overflow: visible;
	}
	body {
		background: #fff;
		font-size: 20pt;
		width: auto;
		height: auto;
		border: 0;
		margin: 0 5%;
		padding: 0;
		overflow: visible;
		float: none !important;
	}

	/* SECTION 2: Remove any elements not needed in print.
	   This would include navigation, ads, sidebars, etc. */
	.nestedarrow,
	.controls,
	.fork-reveal,
	.share-reveal,
	.state-background,
	.reveal .progress,
	.reveal .backgrounds {
		display: none !important;
	}

	/* SECTION 3: Set body font face, size, and color.
	   Consider using a serif font for readability. */
	body, p, td, li, div {
		font-size: 20pt!important;
		font-family: Georgia, "Times New Roman", Times, serif !important;
		color: #000;
	}

	/* SECTION 4: Set heading font face, sizes, and color.
	   Differentiate your headings from your body text.
	   Perhaps use a large sans-serif for distinction. */
	h1,h2,h3,h4,h5,h6 {
		color: #000!important;
		height: auto;
		line-height: normal;
		font-family: Georgia, "Times New Roman", Times, serif !important;
		text-shadow: 0 0 0 #000 !important;
		text-align: left;
		letter-spacing: normal;
	}
	/* Need to reduce the size of the fonts for printing */
	h1 { font-size: 28pt !important;  }
	h2 { font-size: 24pt !important; }
	h3 { font-size: 22pt !important; }
	h4 { font-size: 22pt !important; font-variant: small-caps; }
	h5 { font-size: 21pt !important; }
	h6 { font-size: 20pt !important; font-style: italic; }

	/* SECTION 5: Make hyperlinks more usable.
	   Ensure links are underlined, and consider appending
	   the URL to the end of the link for usability. */
	a:link,
	a:visited {
		color: #000 !important;
		font-weight: bold;
		text-decoration: underline;
	}
	/*
	.reveal a:link:after,
	.reveal a:visited:after {
		content: " (" attr(href) ") ";
		color: #222 !important;
		font-size: 90%;
	}
	*/


	/* SECTION 6: more reveal.js specific additions by @skypanther */
	ul, ol, div, p {
		visibility: visible;
		position: static;
		width: auto;
		height: auto;
		display: block;
		overflow: visible;
		margin: 0;
		text-align: left !important;
	}
	.reveal pre,
	.reveal table {
		margin-left: 0;
		margin-right: 0;
	}
	.reveal pre code {
		padding: 20px;
		border: 1px solid #ddd;
	}
	.reveal blockquote {
		margin: 20px 0;
	}
	.reveal .slides {
		position: static !important;
		width: auto !important;
		height: auto !important;

		left: 0 !important;
		top: 0 !important;
		margin-left: 0 !important;
		margin-top: 0 !important;
		padding: 0 !important;
		zoom: 1 !important;

		overflow: visible !important;
		display: block !important;

		text-align: left !important;
		-webkit-perspective: none;
		   -moz-perspective: none;
		    -ms-perspective: none;
		        perspective: none;

		-webkit-perspective-origin: 50% 50%;
		   -moz-perspective-origin: 50% 50%;
		    -ms-perspective-origin: 50% 50%;
		        perspective-origin: 50% 50%;
	}
	.reveal .slides section {
		visibility: visible !important;
		position: static !important;
		width: auto !important;
		height: auto !important;
		display: block !important;
		overflow: visible !important;

		left: 0 !important;
		top: 0 !important;
		margin-left: 0 !important;
		margin-top: 0 !important;
		padding: 60px 20px !important;
		z-index: auto !important;

		opacity: 1 !important;

		page-break-after: always !important;

		-webkit-transform-style: flat !important;
		   -moz-transform-style: flat !important;
		    -ms-transform-style: flat !important;
		        transform-style: flat !important;

		-webkit-transform: none !important;
		   -moz-transform: none !important;
		    -ms-transform: none !important;
		        transform: none !important;

		-webkit-transition: none !important;
		   -moz-transition: none !important;
		    -ms-transition: none !important;
		        transition: none !important;
	}
	.reveal .slides section.stack {
		padding: 0 !important;
	}
	.reveal section:last-of-type {
		page-break-after: avoid !important;
	}
	.reveal section .fragment {
		opacity: 1 !important;
		visibility: visible !important;

		-webkit-transform: none !important;
		   -moz-transform: none !important;
		    -ms-transform: none !important;
		        transform: none !important;
	}
	.reveal section img {
		display: block;
		margin: 15px 0px;
		background: rgba(255,255,255,1);
		border: 1px solid #666;
		box-shadow: none;
	}

	.reveal section small {
		font-size: 0.8em;
	}

}  
</script>


<script id="pdf-css" type="application/dynamic-css">
    
/**
 * This stylesheet is used to print reveal.js
 * presentations to PDF.
 *
 * https://github.com/hakimel/reveal.js#pdf-export
 */

* {
	-webkit-print-color-adjust: exact;
}

body {
	margin: 0 auto !important;
	border: 0;
	padding: 0;
	float: none !important;
	overflow: visible;
}

html {
	width: 100%;
	height: 100%;
	overflow: visible;
}

/* Remove any elements not needed in print. */
.nestedarrow,
.reveal .controls,
.reveal .progress,
.reveal .playback,
.reveal.overview,
.fork-reveal,
.share-reveal,
.state-background {
	display: none !important;
}

h1, h2, h3, h4, h5, h6 {
	text-shadow: 0 0 0 #000 !important;
}

.reveal pre code {
	overflow: hidden !important;
	font-family: Courier, 'Courier New', monospace !important;
}

ul, ol, div, p {
	visibility: visible;
	position: static;
	width: auto;
	height: auto;
	display: block;
	overflow: visible;
	margin: auto;
}
.reveal {
	width: auto !important;
	height: auto !important;
	overflow: hidden !important;
}
.reveal .slides {
	position: static;
	width: 100%;
	height: auto;

	left: auto;
	top: auto;
	margin: 0 !important;
	padding: 0 !important;

	overflow: visible;
	display: block;

	-webkit-perspective: none;
	   -moz-perspective: none;
	    -ms-perspective: none;
	        perspective: none;

	-webkit-perspective-origin: 50% 50%; /* there isn't a none/auto value but 50-50 is the default */
	   -moz-perspective-origin: 50% 50%;
	    -ms-perspective-origin: 50% 50%;
	        perspective-origin: 50% 50%;
}

.reveal .slides section {
	page-break-after: always !important;

	visibility: visible !important;
	position: relative !important;
	display: block !important;
	position: relative !important;

	margin: 0 !important;
	padding: 0 !important;
	box-sizing: border-box !important;
	min-height: 1px;

	opacity: 1 !important;

	-webkit-transform-style: flat !important;
	   -moz-transform-style: flat !important;
	    -ms-transform-style: flat !important;
	        transform-style: flat !important;

	-webkit-transform: none !important;
	   -moz-transform: none !important;
	    -ms-transform: none !important;
	        transform: none !important;
}

.reveal section.stack {
	margin: 0 !important;
	padding: 0 !important;
	page-break-after: avoid !important;
	height: auto !important;
	min-height: auto !important;
}

.reveal img {
	box-shadow: none;
}

.reveal .roll {
	overflow: visible;
	line-height: 1em;
}

/* Slide backgrounds are placed inside of their slide when exporting to PDF */
.reveal section .slide-background {
	display: block !important;
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	z-index: -1;
}

/* All elements should be above the slide-background */
.reveal section>* {
	position: relative;
	z-index: 1;
}

/* Display slide speaker notes when 'showNotes' is enabled */
.reveal .speaker-notes-pdf {
	display: block;
	width: 100%;
	max-height: none;
	left: auto;
	top: auto;
	z-index: 100;
}

/* Display slide numbers when 'slideNumber' is enabled */
.reveal .slide-number-pdf {
	display: block;
	position: absolute;
	font-size: 14px;
}

</script>


<script>
var style = document.createElement( 'style' );
style.type = 'text/css';
var style_script_id = window.location.search.match( /print-pdf/gi ) ? 'pdf-css' : 'paper-css';
var style_script = document.getElementById(style_script_id).text;
style.innerHTML = style_script;
document.getElementsByTagName('head')[0].appendChild(style);
</script>

</head>
<body>
  <div class="reveal">
    <div class="slides">

<section>
    <h1 class="title">Advanced R: Day 3, part 3</h1>
  <h1 class="subtitle">Data viz with ggplot</h1>
    <h2 class="author">Kumar Ramanathan</h2>
    <h3 class="date">2018-09-19</h3>
</section>

<section><section id="introduction-to-ggplot" class="titleslide slide level1"><h1>Introduction to ggplot</h1></section><section id="why-ggplot" class="slide level2">
<h2>Why ggplot?</h2>
<ul>
<li class="fragment">Highly customizable and extensible.</li>
<li class="fragment">Designed to work with <code>dplyr</code> and other <code>tidyverse</code> packages.</li>
<li class="fragment">In use for over 10 years, meaning that help is widely available.</li>
<li class="fragment">Wide variety of avilable <a href="http://www.ggplot2-exts.org/gallery/">extensions</a></li>
</ul>
</section><section id="useful-resources" class="slide level2">
<h2>Useful resources</h2>
<ul>
<li>The <a href="https://github.com/rstudio/cheatsheets/blob/master/data-visualization-2.1.pdf">ggplot cheatsheet</a></li>
<li>The <a href="https://ggplot2.tidyverse.org/reference/index.html">ggplot reference guide</a></li>
<li>The <a href="http://r4ds.had.co.nz/data-visualisation.html">Data Visualization chapter</a> in the “R for Data Science” book</li>
<li>And, of course, the help files that come with the package itself.</li>
</ul>
</section><section id="lets-make-sure-we-have-the-necessary-data-frames-for-our-examples" class="slide level2">
<h2>Let’s make sure we have the necessary data frames for our examples</h2>
<ol type="1">
<li>If you still have <code>imports</code>, <code>generation</code>, <code>merged_energy</code>, <code>long_gen</code> and <code>long_merged_energy</code> in your Enrivorment, read in <code>gapminder</code> and recreate <code>gapminder07</code>.</li>
<li>Alternatively, or if you are missing any of those objects from your workspace, run the following line of code:</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">source</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data/day3_objects.R&quot;</span>))</code></pre></div>
</section></section>
<section><section id="basics-grammar-of-graphics" class="titleslide slide level1"><h1>Basics: grammar of graphics</h1></section><section id="components-of-a-basic-plot" class="slide level2">
<h2>Components of a basic plot</h2>
<ul>
<li class="fragment"><strong>data</strong>: a data frame, provided to the <code>ggplot()</code> function</li>
<li class="fragment"><strong>geometric objects</strong>: the objects/shapes that you want to plot, indicated through one of the many available <code>geom</code> functions, such as <code>geom_point()</code> or <code>geom_hist()</code></li>
<li class="fragment"><strong>aesthetic mapping</strong>: the mapping from the data to the geometric objects, provided in an <code>aes()</code> function nested within the chosen <code>geom</code> function</li>
<li class="fragment">connected with the <code>+</code> operator</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="op">&lt;</span>DATA FRAME<span class="op">&gt;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="er">&lt;</span>GEOM_FUNCTION<span class="op">&gt;</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="op">&lt;</span>VARIABLES<span class="op">&gt;</span>))</code></pre></div>
<aside class="notes">
Write this on the board, without data= and mapping= specified.
</aside>
</section><section id="example-scatterplot-from-day-1" class="slide level2">
<h2>Example: Scatterplot from Day 1</h2>
<p>Task:<br>Create scatterplot of <code>lifeExp</code> against <code>gdpPercap</code> from <code>gapminder07</code> data.</p>
<p>Steps:</p>
<ol type="1">
<li class="fragment">Supply <code>gapminder07</code> data frame as input to <code>ggplot()</code> function</li>
<li class="fragment">Choose a <code>geom</code>; in this case we choose <code>geom_point()</code> to generate points</li>
<li class="fragment">Supply aesthetic mapping, i.e. specify <code>x</code> and <code>y</code> values, to <code>geom_point()</code>.</li>
</ol>
</section><section id="example-scatterplot-from-day-1-1" class="slide level2">
<h2>Example: Scatterplot from Day 1</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder07) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp))</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/scatterplot%201-1.png" width="768" /></p>
</section><section id="example-scatterplot-from-day-1-2" class="slide level2">
<h2>Example: Scatterplot from Day 1</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(gapminder07) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Relationship between life expectancy and GDP per capita in 2007&quot;</span>, 
       <span class="dt">x =</span> <span class="st">&quot;GDP per capita&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Life expectancy&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/scatterplot%202-1.png" width="768" /></p>
</section><section id="exercise-1-scatterplot" class="slide level2">
<h2>Exercise 1: Scatterplot</h2>
<p>Using the <code>gapminder07</code> data, create a scatterplot of the natural log of <code>gdpPercap</code> as a function of the natural log of <code>pop</code>. Give it a title and axis labels.</p>
<p>Remember, you will need three functions: <code>ggplot()</code>, <code>geom_point()</code>, and <code>labs()</code>.</p>
<aside class="notes">
You can create a new script file for your exercises in this session, or you can continue to use script files from earlier in the day. In either case, make sure to give the file a sensible filename and to demarcate sections with meaningful comments.
</aside>
</section><section id="exercise-1-scatterplot-1" class="slide level2">
<h2>Exercise 1: Scatterplot</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(gapminder07) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">log</span>(pop), <span class="dt">y =</span> <span class="kw">log</span>(gdpPercap))) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Relationship between GDP per capita and population in 2007&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Logged GDP per capita&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Logged life expectancy&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/scatterplot%20exercise-1.png" width="768" /></p>
</section></section>
<section><section id="preparing-your-data" class="titleslide slide level1"><h1>Preparing your data</h1></section><section id="example-energy-generated-over-time" class="slide level2">
<h2>Example: Energy generated over time</h2>
<p>Task:<br>Plot a <em>column chart</em> of <em>total</em> energy generated over time.</p>
<p>Steps:</p>
<ol type="1">
<li class="fragment">Choose long-format generation data, i.e. <code>long_gen</code>.</li>
<li class="fragment">Manipulate data frame to calculate total output per date-time.</li>
<li class="fragment">Pipe manipulated data frame into plot.</li>
<li class="fragment">Select <code>geom_col()</code> and map appropriate <code>x</code> and <code>y</code> variables.</li>
</ol>
</section><section id="example-energy-generated-over-time-1" class="slide level2">
<h2>Example: Energy generated over time</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">long_gen <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(datetime) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">output=</span><span class="kw">sum</span>(output)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(<span class="dt">x=</span>datetime, <span class="dt">y=</span>output)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Total energy generated, by hour&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Hour&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Output (MW)&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/data%20prep%202-1.png" width="768" /></p>
</section><section id="exercise-2-hydro-power-generated-over-time" class="slide level2">
<h2>Exercise 2: Hydro power generated over time</h2>
<p>Task:<br>Plot a column chart <em>hydroelectric</em> power generated over time.</p>
<p><small>Hint: There are two types of hydroelectric sources in the data: <code>large_hydro</code> and <code>small_hydro</code>.</small></p>
</section><section id="exercise-2-hydro-power-generated-over-time-1" class="slide level2">
<h2>Exercise 2: Hydro power generated over time</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">long_gen <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(source<span class="op">==</span><span class="st">&quot;large_hydro&quot;</span><span class="op">|</span>source<span class="op">==</span><span class="st">&quot;small_hydro&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(datetime) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">output=</span><span class="kw">sum</span>(output)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(<span class="dt">x=</span>datetime, <span class="dt">y=</span>output)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Total hydro power generated, by hour&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Hour&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Output (MW)&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/data%20prep%20ex1-1.png" width="768" /></p>
</section><section id="exercise-2-hydro-power-generated-over-time-2" class="slide level2">
<h2>Exercise 2: Hydro power generated over time</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">generation <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hydro=</span>large_hydro<span class="op">+</span>small_hydro) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(<span class="dt">x=</span>datetime, <span class="dt">y=</span>hydro)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Total hydro power generated, by hour&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Hour&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Output (MW)&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/data%20prep%20ex2-1.png" width="768" /></p>
</section></section>
<section><section id="geometric-objects" class="titleslide slide level1"><h1>Geometric objects</h1></section><section id="line-plots-geom_line" class="slide level2">
<h2>Line plots: <code>geom_line()</code></h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">imports <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>datetime, <span class="dt">y=</span>imports)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Energy imports over time&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Hour&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Amount imported (MW)&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/geom_line%201-1.png" width="768" /></p>
</section><section id="interlude-changing-geom-characteristics" class="slide level2">
<h2>Interlude: changing geom characteristics</h2>
<ul>
<li class="fragment">In the geom functions, we have only been supplying aesthetic mapping (in <code>aes()</code>).</li>
<li class="fragment">Geom functions can also control characteristics of the geom object, <em>outside</em> the <code>aes()</code> function.</li>
<li class="fragment">In most geoms, we can modulate <code>size=</code> and <code>col=</code>.</li>
<li class="fragment">Let’s try it with the line plot we just made.</li>
</ul>
</section><section id="interlude-changing-geom-characteristics-1" class="slide level2">
<h2>Interlude: changing geom characteristics</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">imports <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>datetime, <span class="dt">y=</span>imports), <span class="dt">size=</span><span class="fl">1.2</span>, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Energy imports over time&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Hour&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Amount imported (MW)&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/geom_line%202-1.png" width="768" /></p>
</section><section id="area-plots-geom_area" class="slide level2">
<h2>Area plots: <code>geom_area()</code></h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">generation <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_area</span>(<span class="kw">aes</span>(<span class="dt">x=</span>datetime, <span class="dt">y=</span>wind), <span class="dt">fill=</span><span class="st">&quot;darkblue&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Hourly wind power generation, Sept 3-9&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Hour&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Output (MW)&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/area%20plot-1.png" width="768" /></p>
</section><section id="box-plots-geom_boxplot" class="slide level2">
<h2>Box plots: <code>geom_boxplot()</code></h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">long_gen <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>source, <span class="dt">y=</span>output)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Amount of energy generated by each source, Sept 3-9&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Source type&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Output (MW)&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/box%20plot-1.png" width="768" /></p>
</section><section id="multiple-geoms-in-one-plot" class="slide level2">
<h2>Multiple geoms in one plot</h2>
<p>Task:<br>Plot a <em>line</em> of large hydro generation over time, and a <em>smoothed line</em> of the same relationship on top of it.</p>
<p>Steps:</p>
<ol type="1">
<li class="fragment">Supply the <code>generation</code> data to <code>ggplot()</code>.</li>
<li class="fragment">Create a line with <code>geom_line()</code> with appropriate <code>x</code> and <code>y</code> aesthetics. Make it turquoise for fun.</li>
<li class="fragment">Create a smoothed line with <code>geom_smooth()</code> with the same <code>x</code> and <code>y</code> aesthetics.
<ol type="1">
<li class="fragment"><code>geom_smooth()</code> plots smoothed conditional means (estimated using a loess regression)</li>
</ol></li>
</ol>
</section><section id="multiple-geoms-in-one-plot-1" class="slide level2">
<h2>Multiple geoms in one plot</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">generation <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>datetime, <span class="dt">y=</span>large_hydro), <span class="dt">col=</span><span class="st">&quot;turquoise3&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">x=</span>datetime, <span class="dt">y=</span>large_hydro)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Hydroelectric (large) generation per hour, Sept 3-9&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Hour&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Output (MW)&quot;</span>)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/multiple%20geoms-1.png" width="768" /></p>
</section><section id="exercise-3-total-output-per-source" class="slide level2">
<h2>Exercise 3: Total output per source</h2>
<p>Task:<br>Create a column chart that shows the total output per source.</p>
<ul>
<li>Change the color of the columns to <code>&quot;darkred&quot;</code>.</li>
<li>Add a horizontal line indicating the mean output across all sources. Use the cheatsheet to identify the <code>geom</code> function that you need.</li>
<li>Add a meaningful title and axis labels using <code>labs()</code>.</li>
</ul>
</section><section id="exercise-3-total-output-per-source-1" class="slide level2">
<h2>Exercise 3: Total output per source</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">long_merged_energy <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(source) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">output=</span><span class="kw">sum</span>(output)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(<span class="dt">x=</span>source, <span class="dt">y=</span>output), <span class="dt">fill=</span><span class="st">&quot;darkred&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept=</span><span class="kw">mean</span>(output))) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Total output per energy source over Sept 3-9&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Output (MW)&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Source&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/exercise3-1.png" width="768" /></p>
</section></section>
<section><section id="additional-layers" class="titleslide slide level1"><h1>Additional layers</h1></section><section id="labels" class="slide level2">
<h2>Labels</h2>
<ul>
<li class="fragment">We have already seen that the <code>labs()</code> layer can add titles (<code>title=</code>) and axis labels (<code>x=</code> and <code>y=</code>) to a plot.</li>
<li class="fragment">It can also add subtitles (<code>subtitle=</code>) and captions (<code>caption=</code>).</li>
</ul>
</section><section id="labels-1" class="slide level2">
<h2>Labels</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">imports <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>datetime, <span class="dt">y=</span>imports), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Energy imports over time in California&quot;</span>, <span class="dt">subtitle=</span><span class="st">&quot;Hourly data from September 3-9, 2018&quot;</span>,
       <span class="dt">caption=</span><span class="st">&quot;Source: California Energy Commission&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Hour&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Amount imported (MW)&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/labels-1.png" width="768" /></p>
<aside class="notes">
No exercise this time, but we will practice this later.
</aside>
</section><section id="scales" class="slide level2">
<h2>Scales</h2>
<ul>
<li class="fragment">Scales allow you to manipulate the relationship between data values and aesthetics beyond aesthetic mapping.
<ul>
<li class="fragment">AKA: scales “control the details of how data values are translated to visual properties” (quote from <a href="https://ggplot2.tidyverse.org/reference/index.html#section-aesthetics">reference guide</a>).</li>
</ul></li>
<li class="fragment">For example:
<ul>
<li class="fragment"><code>scale_alpha</code>: control transparency settings</li>
<li class="fragment"><code>scale_color</code> and <code>scale_fill</code>: control color palettes and other aspects of data mapped to colors</li>
<li class="fragment"><code>scale_x</code> and <code>scale_y</code>: control the position of axis markers</li>
</ul></li>
<li class="fragment">The cheatsheet is your friend!</li>
</ul>
</section><section id="scales-1" class="slide level2">
<h2>Scales</h2>
<p>Task:<br>Recreate line plot of imports over time, but label x-axis with hours rather than dates.</p>
<p>Steps:</p>
<ol start="0" type="1">
<li class="fragment">Check the cheatsheet!</li>
<li class="fragment">Supply <code>imports</code> data to <code>ggplot()</code>.</li>
<li class="fragment">Add a <code>geom_line()</code> layer and map appropriate <code>x</code> and <code>y</code> variables.</li>
<li class="fragment">Add a <code>scale_x_datetime()</code> layer and use <code>date_labels=</code> and <code>date_breaks=</code> arguments to modify x-axis labels and breaks.</li>
<li class="fragment">Add a <code>labs()</code> layer.</li>
</ol>
</section><section id="example-imports-over-time" class="slide level2">
<h2>Example: Imports over time</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">imports <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>datetime, <span class="dt">y=</span>imports), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_x_datetime</span>(<span class="dt">date_labels=</span><span class="st">&quot;%H:%M&quot;</span>, <span class="dt">date_breaks=</span><span class="st">&quot;12 hours&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Energy imports over time in California&quot;</span>, <span class="dt">subtitle=</span><span class="st">&quot;Hourly data from September 3-9, 2018&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Hour&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Amount imported (MW)&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/scales%20dates-1.png" width="768" /></p>
<aside class="notes">
See lecture notes for details on what’s going on inside the scale function. Or read the help file. No exercise this time, but we will practice this later.
</aside>
</section><section id="themes-presets" class="slide level2">
<h2>Themes: presets</h2>
<p>ggplot comes with several preset themes that can be added as layers, including:</p>
<ul>
<li><code>theme_grey()</code>: default</li>
<li><code>theme_bw()</code>: strip colors, including grey gradients</li>
<li><code>theme_dark()</code> and <code>theme_light()</code>: change the background of the coordinate system</li>
<li><code>theme_minimal()</code> and <code>theme_void()</code>: see reference guide for details</li>
</ul>
</section><section id="example-imports-over-time-1" class="slide level2">
<h2>Example: Imports over time</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">imports <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>datetime, <span class="dt">y=</span>imports), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_x_datetime</span>(<span class="dt">date_labels=</span><span class="st">&quot;%H:%M&quot;</span>, <span class="dt">date_breaks=</span><span class="st">&quot;12 hours&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Energy imports over time in California&quot;</span>, <span class="dt">subtitle=</span><span class="st">&quot;Hourly data from September 3-9, 2018&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Hour&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Amount imported (MW)&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme_minimal</span>()</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/theme%20preset-1.png" width="768" /></p>
</section><section id="themes-manual" class="slide level2">
<h2>Themes: manual</h2>
<p>The <code>theme()</code> layer lets you modulate many components of the theme, including:</p>
<ul>
<li class="fragment">Angle, position, and other characteristics of axis labels (e.g. <code>axis.labels.x =</code>).</li>
<li class="fragment">Angle, position, and other characteristics of legends (e.g. <code>legend.position =</code>).</li>
<li class="fragment">Characteristics of the background of the plot (e.g. <code>plot.background =</code>).</li>
<li class="fragment">For a full list of the components that can be modified, see the help file for <code>ggplot2::theme()</code>.</li>
</ul>
</section><section id="example-imports-over-time-2" class="slide level2">
<h2>Example: Imports over time</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">imports <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>datetime, <span class="dt">y=</span>imports), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_x_datetime</span>(<span class="dt">date_labels=</span><span class="st">&quot;%H:%M&quot;</span>, <span class="dt">date_breaks=</span><span class="st">&quot;12 hours&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Energy imports over time in California&quot;</span>, <span class="dt">subtitle=</span><span class="st">&quot;Hourly data from September 3-9, 2018&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Hour&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Amount imported (MW)&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x=</span><span class="kw">element_text</span>(<span class="dt">angle=</span><span class="dv">45</span>, <span class="dt">hjust=</span><span class="dv">1</span>, <span class="dt">size=</span><span class="dv">12</span>))</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/theme%20manual-1.png" width="768" /></p>
</section><section id="coordinate-system-adjustment" class="slide level2">
<h2>Coordinate system adjustment</h2>
<ul>
<li class="fragment"><code>coord_flip()</code> is the default Cartesian coordinate system used; by explicitly calling this function, you can change the limits of the <code>x</code> and <code>y</code> axes from their defaults</li>
<li class="fragment"><code>coord_fixed()</code> sets a fixed aspect ratio between the <code>x</code> and <code>y</code> axes</li>
<li class="fragment"><code>coord_transform()</code> lets you transform the Cartesian coordinates using functions like <code>sqrt</code> or <code>log</code></li>
<li class="fragment"><code>coord_polar()</code> changes the coordinate system to polar coordinates rather than a Cartesian system</li>
</ul>
</section><section id="example-coord_flip" class="slide level2">
<h2>Example: coord_flip()</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">long_gen <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date=</span>lubridate<span class="op">::</span><span class="kw">date</span>(datetime)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(date) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">output=</span><span class="kw">sum</span>(output)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(<span class="dt">x=</span>date, <span class="dt">y=</span>output)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Total energy generated, by day&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Day&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Output (MW)&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/coord_flip%20pre-1.png" width="768" /></p>
</section><section id="example-coord_flip-1" class="slide level2">
<h2>Example: coord_flip()</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">long_gen <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date=</span>lubridate<span class="op">::</span><span class="kw">date</span>(datetime)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(date) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">output=</span><span class="kw">sum</span>(output)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(<span class="dt">x=</span>date, <span class="dt">y=</span>output)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Total energy generated, by day&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Day&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Output (MW)&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/coord_flip%20post-1.png" width="768" /></p>
</section><section id="stats" class="slide level2">
<h2>Stats</h2>
<ul>
<li class="fragment">There are several <code>stat</code> functions in ggplot that enable you to conduct statistical transformations of your data prior to plotting.</li>
<li class="fragment"><code>stat</code> and <code>geom</code> layers can be used interchangeably, as each <code>stat</code> layer has a <code>geom</code> argument and vice versa.</li>
<li class="fragment">You may want to use stat layers or arguments to override default settings, or to use transformed versions of a variable in your plot.</li>
<li class="fragment">For more, see <a href="http://r4ds.had.co.nz/data-visualisation.html#statistical-transformations">Chapter 3.7 of the R for data science online textbook</a>.</li>
</ul>
</section></section>
<section><section id="visualizing-grouped-data" class="titleslide slide level1"><h1>Visualizing grouped data</h1></section><section id="colors-and-fill" class="slide level2">
<h2>Colors and fill</h2>
<p>Task:<br>Create a line plot of energy output over time, with separate lines for each source.</p>
<p>Steps:</p>
<ol type="1">
<li class="fragment">Supply the data frame <code>long_merged_energy</code> to <code>ggplot()</code>.</li>
<li class="fragment">Add a <code>geom_line()</code> layer and specify <code>x=datetime</code> and <code>y=output</code>.</li>
<li class="fragment">Also specify that <code>group=source</code> and <code>col=source</code>.</li>
<li class="fragment">Add a <code>labs()</code> layer.</li>
</ol>
</section><section id="colors-and-fill-1" class="slide level2">
<h2>Colors and fill</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">long_merged_energy <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>datetime, <span class="dt">y=</span>output, <span class="dt">group=</span>source, <span class="dt">col=</span>source)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Output by energy source over time&quot;</span>, <span class="dt">subtitle=</span><span class="st">&quot;Hourly data from September 3-9, 2018&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Hour&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Output (MW)&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/aes%20colors%201-1.png" width="768" /></p>
</section><section id="exercise-4-colors-and-fill" class="slide level2">
<h2>Exercise 4: Colors and fill</h2>
<p>Task:<br>Create a line plot that compares generation of wind, solar, and geothermal energy over time.</p>
<p><small>Bonus: Set the line size to 1.5.</small></p>
</section><section id="exercise-4-colors-and-fill-1" class="slide level2">
<h2>Exercise 4: Colors and fill</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">long_merged_energy <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(source<span class="op">==</span><span class="st">&quot;wind&quot;</span><span class="op">|</span>source<span class="op">==</span><span class="st">&quot;solar&quot;</span><span class="op">|</span>source<span class="op">==</span><span class="st">&quot;geothermal&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>datetime, <span class="dt">y=</span>output, <span class="dt">group=</span>source, <span class="dt">col=</span>source), <span class="dt">size=</span><span class="fl">1.5</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Wind vs. Solar vs. Geothermal generation&quot;</span>, <span class="dt">subtitle=</span><span class="st">&quot;Hourly data from September 3-9, 2018&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Hour&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Output (MW)&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/aes%20colors%20ex-1.png" width="768" /></p>
</section><section id="customizing-with-scale_color-layers" class="slide level2">
<h2>Customizing with scale_color layers</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">long_merged_energy <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(source<span class="op">==</span><span class="st">&quot;wind&quot;</span><span class="op">|</span>source<span class="op">==</span><span class="st">&quot;solar&quot;</span><span class="op">|</span>source<span class="op">==</span><span class="st">&quot;geothermal&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>datetime, <span class="dt">y=</span>output, <span class="dt">group=</span>source, <span class="dt">col=</span>source), <span class="dt">size=</span><span class="fl">1.5</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">palette=</span><span class="st">&quot;Accent&quot;</span>, <span class="dt">name=</span><span class="st">&quot;Energy source&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Wind vs. Solar vs. Geothermal generation&quot;</span>, <span class="dt">subtitle=</span><span class="st">&quot;Hourly data from September 3-9, 2018&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Hour&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Output (MW)&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/aes%20colors%202-1.png" width="768" /></p>
</section><section id="colors-and-fill-2" class="slide level2">
<h2>Colors and fill</h2>
<ul>
<li><code>col=</code> is used to color objects like lines and points</li>
<li><code>fill=</code> is used to color objects like columns and histograms
<ul>
<li><code>col=</code> will create colored outlines for such objects</li>
</ul></li>
<li>After some trial and error, this will become intuitive</li>
</ul>
</section><section id="position-adjustment" class="slide level2">
<h2>Position adjustment</h2>
<ul>
<li class="fragment">Once we introduce a grouping variable to a <code>geom</code> function, we generate multiple geometric objects on the same plot.</li>
<li class="fragment">Colors and fill help us distinguish each object from other objects.</li>
<li class="fragment">Another way to distinguish objects, often used together with color/fill, is <em>position adjustment</em>.</li>
</ul>
</section><section id="example-energy-use-by-day" class="slide level2">
<h2>Example: Energy use by day</h2>
<p>Task:<br>Create a column chart of energy use by day, grouped by source.</p>
<p>Steps:</p>
<ol type="1">
<li class="fragment">Modify <code>long_merged_energy</code> to summarize output by date and source.
<ol type="1">
<li class="fragment">Use <code>mutate()</code> to create a <code>date</code> variable from <code>datetime</code>.</li>
<li class="fragment">Use <code>group_by()</code> and <code>summarize()</code> to calculate total output per date per source.</li>
</ol></li>
<li class="fragment">Supply modified data frame to <code>ggplot()</code></li>
<li class="fragment">Add a <code>geom_col()</code> layer, supply <code>x</code> and <code>y</code> aesthetics.</li>
<li class="fragment">Specify <code>group=source</code> and <code>fill=source</code>.</li>
<li class="fragment">Add a <code>labs()</code> layer.</li>
</ol>
</section><section id="example-energy-use-by-day-1" class="slide level2">
<h2>Example: Energy use by day</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">long_merged_energy <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date=</span>lubridate<span class="op">::</span><span class="kw">date</span>(datetime)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(date, source) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">output=</span><span class="kw">sum</span>(output)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(<span class="dt">x=</span>date, <span class="dt">y=</span>output, <span class="dt">group=</span>source, <span class="dt">fill=</span>source)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Energy use by day&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Day&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Output (MW)&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/col%20stack-1.png" width="768" /></p>
</section><section id="example-energy-use-by-day-2" class="slide level2">
<h2>Example: Energy use by day</h2>
<ul>
<li class="fragment">This column chart is useful if our main goal is to examine total output over time across sources.</li>
<li class="fragment">But what if our main goal is to compare trends across sources?
<ul>
<li class="fragment">We can use <code>position=&quot;dodge&quot;</code> in <code>geom_col()</code> ‘unstack’ the columns for each source.</li>
</ul></li>
<li class="fragment">What if our goal is to compare what portion of output per day each source comprises?
<ul>
<li class="fragment">We can use <code>position=&quot;fill&quot;</code> to normalize height of stacked columns.</li>
</ul></li>
</ul>
</section><section id="example-energy-use-by-day-pos-dodge" class="slide level2">
<h2>Example: Energy use by day (pos dodge)</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">long_merged_energy <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date=</span>lubridate<span class="op">::</span><span class="kw">date</span>(datetime)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(date, source) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">output=</span><span class="kw">sum</span>(output)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(<span class="dt">x=</span>date, <span class="dt">y=</span>output, <span class="dt">group=</span>source, <span class="dt">fill=</span>source), <span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Energy use by day&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Day&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Output (MW)&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/col%20dodge-1.png" width="768" /></p>
</section><section id="example-energy-use-by-day-pos-fill" class="slide level2">
<h2>Example: Energy use by day (pos fill)</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">long_merged_energy <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date=</span>lubridate<span class="op">::</span><span class="kw">date</span>(datetime)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(date, source) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">output=</span><span class="kw">sum</span>(output)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(<span class="dt">x=</span>date, <span class="dt">y=</span>output, <span class="dt">group=</span>source, <span class="dt">fill=</span>source), <span class="dt">position=</span><span class="st">&quot;fill&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Energy use by day&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Day&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Output (MW)&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/col%20fill-1.png" width="768" /></p>
</section><section id="shapes-and-linetypes" class="slide level2">
<h2>Shapes and linetypes</h2>
<ul>
<li class="fragment">Colors/fill and position adjustment are the most common and intuitive way to distinguish geometric objects from each other.</li>
<li class="fragment">Shapes and linetypes are two other ways.</li>
<li class="fragment">The idea here is to modify what the object actually looks like.</li>
</ul>
</section><section id="example-energy-source-group-by-day" class="slide level2">
<h2>Example: Energy source group, by day</h2>
<p>Task:<br></p>
<p>Steps:</p>
<ol type="1">
<li class="fragment">Prepare data frame that summarizes output by date and “group” from <code>regroup</code>.</li>
<li class="fragment">Supply modified data frame to <code>ggplot()</code>.</li>
<li class="fragment">Two choices!
<ol type="1">
<li class="fragment">Add <code>geom_line()</code> and <code>geom_point()</code> with <code>shape=group</code>.</li>
<li class="fragment">Add <code>geom_line()</code> with <code>linetype=group</code>.</li>
</ol></li>
</ol>
</section><section id="example-energy-source-group-by-day-1" class="slide level2">
<h2>Example: Energy source group by day</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Prepare data</span>
long_merged_energy_regroup &lt;-<span class="st"> </span>long_merged_energy <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">type =</span> source) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">merge</span>(regroup, <span class="dt">by =</span> <span class="st">&quot;type&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date=</span>lubridate<span class="op">::</span><span class="kw">date</span>(datetime)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(date, group) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">output=</span><span class="kw">sum</span>(output))

<span class="co"># Take a look at our prepared data</span>
<span class="kw">head</span>(long_merged_energy_regroup)</code></pre></div>
<pre><code>## # A tibble: 6 x 3
## # Groups:   date [2]
##   date       group        output
##   &lt;date&gt;     &lt;chr&gt;         &lt;dbl&gt;
## 1 2018-09-03 hydro        96808.
## 2 2018-09-03 imports     174288 
## 3 2018-09-03 natural_gas 152894.
## 4 2018-09-03 nuclear      53856 
## 5 2018-09-03 renewable   166340 
## 6 2018-09-04 hydro       122112.</code></pre>
</section><section id="example-energy-source-group-by-day-2" class="slide level2">
<h2>Example: Energy source group, by day</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">long_merged_energy_regroup <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>date, <span class="dt">y=</span>output, <span class="dt">group=</span>group, <span class="dt">col=</span>group), <span class="dt">size=</span><span class="fl">0.8</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x=</span>date, <span class="dt">y=</span>output, <span class="dt">group=</span>group, <span class="dt">shape=</span>group)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Output by source group over time&quot;</span>, <span class="dt">subtitle=</span><span class="st">&quot;Data collected during September 3-9, 2018&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Date&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Output (MW)&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/aes%20shapes-1.png" width="768" /></p>
</section><section id="example-energy-source-group-by-day-3" class="slide level2">
<h2>Example: Energy source group, by day</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">long_merged_energy_regroup <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>date, <span class="dt">y=</span>output, <span class="dt">group=</span>group, <span class="dt">linetype=</span>group), <span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Output by source group over time&quot;</span>, <span class="dt">subtitle=</span><span class="st">&quot;Data collected during September 3-9, 2018&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Date&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Output (MW)&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/aes%20linetypes-1.png" width="768" /></p>
</section><section id="sizes-and-alpha" class="slide level2">
<h2>Sizes and alpha</h2>
<ul>
<li class="fragment"><code>size=</code> and <code>alpha=</code> inside <code>aes()</code> modulate the size and transparency of geom objects based on some data value.</li>
<li class="fragment">They are particularly useful when you want to distinguish objects based on some <em>continuous</em> variable.</li>
<li class="fragment">Let’s return to the Gapminder data for an example.</li>
</ul>
</section><section id="example-life-expectancy-over-gdp" class="slide level2">
<h2>Example: Life expectancy over GDP</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder07 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">log</span>(gdpPercap), <span class="dt">y=</span>lifeExp, <span class="dt">size=</span>pop, <span class="dt">col=</span>continent)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_size_continuous</span>(<span class="dt">name=</span><span class="st">&quot;Population&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_color_discrete</span>(<span class="dt">name=</span><span class="st">&quot;Continent&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Life expectancy as a function of GDP per capita in 2007&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Logged GDP per capita&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Life expectancy&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/aes%20size-1.png" width="768" /></p>
</section><section id="exercise-5-average-hourly-output-by-source" class="slide level2">
<h2>Exercise 5: Average hourly output by source</h2>
<p>Task:<br>Visualize the average output for each hour of the day, grouped by source.</p>
<p><small>You need to identify the output per source per hour (e.g. 01:00, 02:00, etc) averaged over all days.</small></p>
<ul>
<li>You will need to prepare your data using both <code>dplyr</code> and <code>lubridate</code> functions.</li>
<li>You can choose which <code>geom</code>(s) to use, and how to demarcate groups.</li>
<li>Bonus: use a scale layer to set a color palette (try <code>&quot;Set3&quot;</code>) and change the legend name.</li>
<li>Remember to add <code>labs()</code>!</li>
</ul>
</section><section id="exercise-5-average-hourly-output-by-source-1" class="slide level2">
<h2>Exercise 5: Average hourly output by source</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ex5 &lt;-<span class="st"> </span>long_merged_energy <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hour=</span>lubridate<span class="op">::</span><span class="kw">hour</span>(datetime)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(hour, source) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">output=</span><span class="kw">sum</span>(output)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_area</span>(<span class="kw">aes</span>(<span class="dt">x=</span>hour, <span class="dt">y=</span>output, <span class="dt">fill=</span><span class="kw">factor</span>(source))) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette=</span><span class="st">&quot;Set3&quot;</span>, <span class="dt">name=</span><span class="st">&quot;Source&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Average hourly output by source&quot;</span>, 
       <span class="dt">subtitle=</span><span class="st">&quot;Data collected during September 3-9&quot;</span>,
       <span class="dt">x=</span><span class="st">&quot;Hour of the day&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Output (MW)&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme_bw</span>()</code></pre></div>
</section><section id="exercise-5-average-hourly-output-by-source-2" class="slide level2">
<h2>Exercise 5: Average hourly output by source</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ex5</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/exercise5%20plot-1.png" width="768" /></p>
</section><section id="facets" class="slide level2">
<h2>Facets</h2>
<ul>
<li class="fragment">So far we have been visualizing grouped data by changing the appearance or position of the objects.</li>
<li class="fragment">A different approach is to use facets, which creates separate coordinate systems for each geometric object.</li>
</ul>
</section><section id="example-comparing-generation-patterns" class="slide level2">
<h2>Example: Comparing generation patterns</h2>
<p>Task:<br>Compare energy generation over time, across sources.</p>
<p>How do we do this? Using what we’ve learned so far:</p>
<ol type="1">
<li class="fragment">Supply <code>long_gen</code> to <code>ggplot()</code>.</li>
<li class="fragment">Add a <code>geom_line()</code> layer, setting <code>x=datetime</code> and <code>y=output</code> in <code>aes()</code>.</li>
<li class="fragment">Let’s set <code>group=source</code> and <code>col=source</code> in <code>aes()</code>.</li>
</ol>
</section><section id="example-comparing-generation-patterns-1" class="slide level2">
<h2>Example: Comparing generation patterns</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">long_gen <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>datetime, <span class="dt">y=</span>output, <span class="dt">group=</span>source, <span class="dt">col=</span>source), <span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Generation over time, by energy source&quot;</span>, <span class="dt">subtitle=</span><span class="st">&quot;Hourly data from September 3-9, 2018&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Hour&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Output (MW)&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/why%20facet-1.png" width="768" /></p>
</section><section id="example-comparing-generation-patterns-2" class="slide level2">
<h2>Example: Comparing generation patterns</h2>
<p>Is this a helpful plot?</p>
<ul>
<li class="fragment">Not if our goal is to compare the patterns of each source.</li>
<li class="fragment">It’s too noisy!</li>
<li class="fragment">Instead of setting <code>col=</code> in <code>aes()</code>, let’s add a <code>facet_wrap()</code> layer.</li>
<li class="fragment">Specifically, <code>facet_wrap(~source)</code>, i.e. tell ggplot to “facet by source”.</li>
</ul>
</section><section id="example-comparing-generation-patterns-3" class="slide level2">
<h2>Example: Comparing generation patterns</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">long_gen <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> datetime, <span class="dt">y =</span> output)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>source) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Generation over time, by energy source&quot;</span>, <span class="dt">subtitle=</span><span class="st">&quot;Hourly data from September 3-9, 2018&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Hour&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Output (MW)&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/facet%201-1.png" width="768" /></p>
</section><section id="example-comparing-generation-patterns-4" class="slide level2">
<h2>Example: Comparing generation patterns</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">long_gen <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> datetime, <span class="dt">y =</span> output)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>source, <span class="dt">scales=</span><span class="st">&quot;free&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Generation over time, by energy source&quot;</span>, <span class="dt">subtitle=</span><span class="st">&quot;Hourly data from September 3-9, 2018&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Hour&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Output (MW)&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/facet%202-1.png" width="768" /></p>
</section><section id="exercise-6-facets" class="slide level2">
<h2>Exercise 6: Facets</h2>
<p>Task:<br>Compare generation patterns for each source in facets. Color the lines using the “group” variable in <code>regroup</code>.</p>
<p>Remember:</p>
<ul>
<li>You will need to prepare your data. Think about the variables that you need: source/type, output, and group.</li>
<li>When you pipe modified data into ggplot, remember that you are grouping in two ways: source/type through facets, and group through color.</li>
</ul>
</section><section id="exercise-6-facets-1" class="slide level2">
<h2>Exercise 6: Facets</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">long_gen_regroup &lt;-<span class="st"> </span>long_gen <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">type =</span> source) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">merge</span>(regroup, <span class="dt">by=</span><span class="st">&quot;type&quot;</span>)

<span class="kw">head</span>(long_gen_regroup)</code></pre></div>
<pre><code>##     type            datetime output     group
## 1 biogas 2018-09-03 00:00:00    239 renewable
## 2 biogas 2018-09-03 01:00:00    240 renewable
## 3 biogas 2018-09-03 02:00:00    237 renewable
## 4 biogas 2018-09-03 03:00:00    241 renewable
## 5 biogas 2018-09-03 04:00:00    240 renewable
## 6 biogas 2018-09-03 05:00:00    239 renewable</code></pre>
</section><section id="exercise-6-facets-2" class="slide level2">
<h2>Exercise 6: Facets</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">long_gen_regroup <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>datetime, <span class="dt">y=</span>output, <span class="dt">group=</span>group, <span class="dt">col=</span>group), <span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">palette=</span><span class="st">&quot;Set1&quot;</span>, <span class="dt">name=</span><span class="st">&quot;Type of energy source&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>type, <span class="dt">scales=</span><span class="st">&quot;free&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Generation over time, by energy source&quot;</span>, <span class="dt">subtitle=</span><span class="st">&quot;Hourly data from September 3-9, 2018&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Hour&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Output (MW)&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</code></pre></div>
<p><img src="day3_R-ggplot_slides_kr_files/figure-revealjs/facets%20ex-1.png" width="768" /></p>
</section></section>
<section><section id="final-notes" class="titleslide slide level1"><h1>Final notes</h1></section><section id="comment-your-code" class="slide level2">
<h2>Comment your code</h2>
<p>Always remember to comment your code!</p>
<p>When writing particularly complex code in <code>dplyr</code> or <code>ggplot2</code>, this includes commenting <em>within</em> a flow of <code>%&gt;%</code> or <code>+</code> operators. See the lecture notes for some examples of this.</p>
</section><section id="saving-images" class="slide level2">
<h2>Saving images</h2>
<p>Three ways to save images created by ggplot:</p>
<ul>
<li>Assign the result of your ggplot code to a named object, which can be saved like other objects in your R workspace</li>
<li>Use the “save” icon in the Plots tab of RStudio</li>
<li>Add the function <code>ggsave()</code> as a layer to your plotting code</li>
</ul>
</section></section>
<section><section id="break" class="titleslide slide level1"><h1>Break!</h1></section></section>
<section><section id="final-exercise" class="titleslide slide level1"><h1>Final Exercise</h1></section><section id="optional-submissions" class="slide level2">
<h2>Optional Submissions</h2>
<p>You’ve created several RMarkdown files with answers to exercises over the past three days. Since you stored these in a git repo forked from the base repo, it is possible to create a pull request and ‘submit’ these files to the base repo. This is <em>optional</em>, but gives you a chance to explore Github functionality and share your work with your classmates.</p>
<p>Before you submit your completed exercises, <em>move every new file in your repo to the <code>submissions</code> folder</em>. This ensures that we won’t inadvertently make changes to the course materials. Then, create a new pull request, asking to merge changes from your fork -&gt; the base repository.</p>
</section></section>
    </div>
  </div>

  <script src="day3_R-ggplot_slides_kr_files/reveal.js-3.3.0.1/lib/js/head.min.js"></script>
  <script src="day3_R-ggplot_slides_kr_files/reveal.js-3.3.0.1/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Push each slide change to the browser history
        history: true,
        // Vertical centering of slides
        center: false,
        // Transition style
        transition: 'default', // none/fade/slide/convex/concave/zoom
        // Transition style for full page slide backgrounds
        backgroundTransition: 'default', // none/fade/slide/convex/concave/zoom



        // Optional reveal.js plugins
        dependencies: [
          { src: 'day3_R-ggplot_slides_kr_files/reveal.js-3.3.0.1/plugin/notes/notes.js', async: true },
        ]
      });
    </script>
  <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
      document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>

<script>
  (function() {
    if (window.jQuery) {
      Reveal.addEventListener( 'slidechanged', function(event) {  
        window.jQuery(event.previousSlide).trigger('hidden');
        window.jQuery(event.currentSlide).trigger('shown');
      });
    }
  })();
</script>


  </body>
</html>
